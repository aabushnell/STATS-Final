---
title: "Tweets"
author: "Aaron Bushnell"
date: "12/2/2018"
output: html_document
---

```{r setup, include=FALSE}
library(readr)
library(mdsr)
library(tidyr)
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
nouns <- read_csv('most-common-nouns-english.csv')
words_file <- read_csv('words.csv')
words <- words_file$Words


text <- rt %>%
  select(screen_name, text)


match_words <- function(tweet){
  matched_values <- sapply(words, grepl, tweet)
  
  return(matched_values)
}

data.frame(mapply(match_words, text$text))

most_common_words <- function(df){
  text_matches <- data.frame(mapply(match_words, df$text)) 
  
  word_occurences <- text_matches %>%
    cbind(rownames(text_matches)) %>%
    rename(word = 'rownames(text_matches)') %>%
    mutate(occurences = rowSums(. == TRUE)) %>%
    select(word, occurences) %>%
    arrange(desc(occurences))
  
  return(word_occurences)
}

most_common_words(rt)

top_n_words <- function(df, n) {
  words <- most_common_words(df) %>%
    select(word)
  
  top_words <- list()
  for (i in 1:n) {
    top_words[i] <- as.character(words$word)[i]
  }
  return(top_words)
}

top_n_words(rt, 5)

top_n_icons <- function(df, n){
  words <- top_n_words(df, n)
  
  urls <- list()
  for (i in 1:n) {
    endpoint <- paste("icon", words[i], sep = "/")
    res <- get_nouns_api(endpoint = endpoint)
    icon_res <- content(res,"parsed")
    urls[i] <- icon_res$icon$preview_url
  }
  
  return(urls)
}

top_n_icons(rt, 5)


nouns_app <- oauth_app("nouns_api", "052ecc4e19c341758fdd1bb618ce6cb4", "b1ca275beca84816ad5c16efe798b4e4")

get_nouns_api <- function(endpoint, baseurl = "http://api.thenounproject.com/", app = nouns_app) {
  url <- modify_url(baseurl, path = endpoint)
  info <- oauth_signature(url, app = app)
  header_oauth <- oauth_header(info)
  GET(url, header_oauth)
}

```


```{r}
present_words <- function(df, col_num){
  words_present <- df %>%
  gather(word, present) %>%
  filter(present == TRUE)
  
  return(words_present)
}

present_words(matched)


```
